import"./modulepreload-polyfill.js";const b="/api/thai-food-dictionary.json",v=/[\u0E00-\u0E7F]/,k=t=>!!t&&typeof t=="object"&&("thai"in t||"trans_de"in t),L=t=>{const e=Object.values(t);return e.some(n=>k(n))?t:e.reduce((n,o)=>(o&&typeof o=="object"&&Object.assign(n,o),n),{})},R=t=>Array.isArray(t)?t.reduce((e,n)=>n&&typeof n=="object"?Object.assign(e,n):e,{}):t&&typeof t=="object"?L(t):{},A=t=>t??"",C=t=>t??"",I=(t,e,n)=>{const o=n==="de"?"meaning_de":"meaning_en",c=n==="de"?"trans_de":"trans_en";return{thainame:t,meaning:A(e[o]),trans:C(e[c])}},D=t=>Object.keys(t).sort((e,n)=>n.length-e.length),g=t=>t?t.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],x=t=>{const e=new Map;return Object.entries(t).forEach(([n,o])=>{[...g(o.trans_de),...g(o.trans_en),...g(o.trans_alt)].forEach(s=>{const r=s.toLowerCase();r.length>1&&!e.has(r)&&e.set(r,n)})}),e},j=t=>Array.from(t.keys()).sort((e,n)=>n.length-e.length),p=(t,e)=>{e.length>0&&t.push([e,null])},_=t=>v.test(t),N=(t,e,n)=>{const o=D(e),c=[];let s=t,r="";for(;s.length>0;){if(/\s/.test(s[0])){p(c,r),r="",s=s.slice(1);continue}let a=!1;for(const i of o)if(s.startsWith(i)){p(c,r),r="",c.push([i,I(i,e[i],n)]),s=s.slice(i.length),a=!0;break}a||(r+=s[0],s=s.slice(1))}return p(c,r),{mode:"thai",entries:c}},M=(t,e,n)=>{const o=x(e),c=j(o),s=[];let r=t,a="";for(;r.length>0;){if(/\s/.test(r[0])){p(s,a),a="",r=r.slice(1);continue}const i=r.toLowerCase();let l=!1;for(const u of c)if(i.startsWith(u)){p(s,a),a="";const h=r.slice(0,u.length),d=o.get(u);d&&e[d]?s.push([h,I(d,e[d],n)]):s.push([h,null]),r=r.slice(u.length),l=!0;break}l||(a+=r[0],r=r.slice(1))}return p(s,a),{mode:"trans",entries:s}};async function U(t,e,n=b){const c=await(await fetch(n)).json(),s=R(c),r=t.trim();return r.length===0?{mode:_(t)?"thai":"trans",entries:[]}:_(r)?N(r,s,e):M(r,s,e)}const H="search",V="search-button",B="clear-button",O="lang",q="result",P="result_entry_template",K="no_results_template",F="summary_result_entry_template",T="th-TH",G=["/","-","_",":",",",".","?","!","|","\\\\"],W=t=>{const e=t.map(n=>n.replace(/[-/\\\\^$*+?.()|[\]{}]/g,"\\\\$&"));return new RegExp(`[${e.join("")}]`,"g")},$=W(G),S=t=>t?"value"in t&&typeof t.value=="string"?t.value:t.getAttribute("value")??"":"",Y=t=>{var n;const e=(n=t==null?void 0:t.shadowRoot)==null?void 0:n.querySelector("input");return e instanceof HTMLInputElement?e.value:""},z=(t,e)=>{var o;const n=(o=t==null?void 0:t.shadowRoot)==null?void 0:o.querySelector("input");n instanceof HTMLInputElement&&(n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),n.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})))},E=(t,e,n,o)=>{const c=o||S(t)||Y(t),s=e.value==="en"?"en":"de";et(c,s,n)},m=t=>{const e=document.getElementById(K);t.innerHTML="",e&&t.appendChild(e.content.cloneNode(!0))},X=(t,e,n)=>{const o=document.getElementById(P),c=document.getElementById(F);if(t.innerHTML="",!o)return;const s=tt(e);if(s&&c){const i=c.content.cloneNode(!0),l=i.querySelector("dfn"),u=i.querySelector("strong");l&&u&&(l.textContent=s.thainame,u.textContent=s.trans,t.appendChild(i))}const r=document.createElement("dl");r.className="thai-food-dict-search__results",e.forEach(([i,l])=>{const u=o.content.cloneNode(!0),h=u.querySelector("dt"),d=u.querySelector("khao-link"),y=u.querySelector("dd"),f=u.querySelector("strong");!h||!y||!f||!d||(l?(d.textContent=l.thainame,f.textContent=l.trans,l.meaning&&y.append(` = ${l.meaning}`)):n==="thai"?(h.textContent=i,f.textContent="?"):(h.textContent="?",f.textContent=i),r.appendChild(u))});const a=document.createElement("khao-card");a.setAttribute("filling","secondary"),a.classList.add("thai-food-dict-search__parts-card"),a.appendChild(r),t.appendChild(a),Z(t)},J=()=>new Promise(t=>{let e=window.speechSynthesis.getVoices();if(e.length>0){t(e);return}window.speechSynthesis.onvoiceschanged=()=>{e=window.speechSynthesis.getVoices(),t(e)}}),Q=async t=>{if(!("speechSynthesis"in window)){alert("Sorry, your browser can't speak!");return}const o=(await J()).filter(s=>s.lang===T)[0];if(!o){alert("Sorry, your browser can't speak Thai!");return}const c=new SpeechSynthesisUtterance;c.text=t,c.voice=o,c.lang=T,c.rate=.8,c.pitch=.8,c.volume=1,window.speechSynthesis.speak(c)},Z=t=>{t.querySelectorAll(".result-thai-word").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const o=(e.textContent??"").trim();o.length>0&&o!=="?"&&Q(o)})})},tt=t=>{if(t.length===0)return null;const e=t.map(([,o])=>o?o.thainame:"?").join(""),n=t.map(([,o])=>o?o.trans:"?").join(" ");return{thainame:e,trans:n,meaning:""}},et=async(t,e,n)=>{const c=t.replace($,"").trim();if(c.length===0){m(n);return}try{const s=await U(c,e),r=s.entries.some(([,a])=>a!==null);if(s.entries.length===0||!r){m(n);return}X(n,s.entries,s.mode)}catch(s){console.error("Thai food dictionary search failed",s),m(n)}},w=()=>{var a;const t=document.getElementById(H),e=document.getElementById(V),n=document.getElementById(B),o=document.getElementById(O),c=document.getElementById(q);if(!t||!e||!o||!c)return;let s=S(t);t.addEventListener("khao-text-field-keyup",i=>{var u;s=((u=i.detail)==null?void 0:u.value)??""}),t.addEventListener("khao-text-field-keydown",i=>{var u;((u=i.detail)==null?void 0:u.key)==="Enter"&&E(t,o,c,s)}),e.addEventListener("click",()=>{E(t,o,c,s)});const r=(a=t.shadowRoot)==null?void 0:a.querySelector("input");r==null||r.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),E(t,o,c,s))}),n==null||n.addEventListener("click",()=>{"value"in t&&(t.value=""),t.setAttribute("value",""),z(t,"");const i={detail:{value:""},bubbles:!0,composed:!0};t.dispatchEvent(new CustomEvent("khao-text-field-change",i)),t.dispatchEvent(new CustomEvent("khao-text-field-keyup",i)),s="",m(c)})};document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>{w()}):w();

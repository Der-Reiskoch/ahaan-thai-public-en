import"./modulepreload-polyfill.js";const b="/api/thai-food-dictionary.json",w=/[\u0E00-\u0E7F]/,L=t=>!!t&&typeof t=="object"&&("thai"in t||"trans_de"in t),v=t=>{const e=Object.values(t);return e.some(n=>L(n))?t:e.reduce((n,s)=>(s&&typeof s=="object"&&Object.assign(n,s),n),{})},S=t=>Array.isArray(t)?t.reduce((e,n)=>n&&typeof n=="object"?Object.assign(e,n):e,{}):t&&typeof t=="object"?v(t):{},k=t=>t??"",C=t=>t??"",T=(t,e,n)=>{const s=n==="de"?"meaning_de":"meaning_en",c=n==="de"?"trans_de":"trans_en";return{thainame:t,meaning:k(e[s]),trans:C(e[c])}},R=t=>Object.keys(t).sort((e,n)=>n.length-e.length),E=t=>t?t.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],A=t=>{const e=new Map;return Object.entries(t).forEach(([n,s])=>{[...E(s.trans_de),...E(s.trans_en),...E(s.trans_alt)].forEach(r=>{const o=r.toLowerCase();o.length>1&&!e.has(o)&&e.set(o,n)})}),e},D=t=>Array.from(t.keys()).sort((e,n)=>n.length-e.length),f=(t,e)=>{e.length>0&&t.push([e,null])},y=t=>w.test(t),j=(t,e,n)=>{const s=R(e),c=[];let r=t,o="";for(;r.length>0;){if(/\s/.test(r[0])){f(c,o),o="",r=r.slice(1);continue}let u=!1;for(const a of s)if(r.startsWith(a)){f(c,o),o="",c.push([a,T(a,e[a],n)]),r=r.slice(a.length),u=!0;break}u||(o+=r[0],r=r.slice(1))}return f(c,o),{mode:"thai",entries:c}},M=(t,e,n)=>{const s=A(e),c=D(s),r=[];let o=t,u="";for(;o.length>0;){if(/\s/.test(o[0])){f(r,u),u="",o=o.slice(1);continue}const a=o.toLowerCase();let d=!1;for(const i of c)if(a.startsWith(i)){f(r,u),u="";const l=o.slice(0,i.length),h=s.get(i);h&&e[h]?r.push([l,T(h,e[h],n)]):r.push([l,null]),o=o.slice(i.length),d=!0;break}d||(u+=o[0],o=o.slice(1))}return f(r,u),{mode:"trans",entries:r}};async function N(t,e,n=b){const c=await(await fetch(n)).json(),r=S(c),o=t.trim();return o.length===0?{mode:y(t)?"thai":"trans",entries:[]}:y(o)?j(o,r,e):M(o,r,e)}const x="search",B="search-button",U="clear-button",O="lang",q="result",H="result_entry_template",K="no_results_template",P="summary_result_entry_template",I=t=>t?"value"in t&&typeof t.value=="string"?t.value:t.getAttribute("value")??"":"",V=t=>{var n;const e=(n=t==null?void 0:t.shadowRoot)==null?void 0:n.querySelector("input");return e instanceof HTMLInputElement?e.value:""},F=(t,e)=>{var s;const n=(s=t==null?void 0:t.shadowRoot)==null?void 0:s.querySelector("input");n instanceof HTMLInputElement&&(n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),n.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})))},g=(t,e,n,s)=>{const c=s||I(t)||V(t),r=e.value==="en"?"en":"de";z(c,r,n)},p=t=>{const e=document.getElementById(K);t.innerHTML="",e&&t.appendChild(e.content.cloneNode(!0))},W=(t,e,n)=>{const s=document.getElementById(H),c=document.getElementById(P);if(t.innerHTML="",!s)return;const r=Y(e);if(r&&c){const a=c.content.cloneNode(!0),d=a.querySelector("dfn"),i=a.querySelector("strong");d&&i&&(d.textContent=r.thainame,i.textContent=r.trans,t.appendChild(a))}const o=document.createElement("dl");o.className="thai-food-dict-search__results",e.forEach(([a,d])=>{const i=s.content.cloneNode(!0),l=i.querySelector("dt"),h=i.querySelector("dd"),m=i.querySelector("strong");!l||!h||!m||(d?(l.textContent=d.thainame,m.textContent=d.trans,d.meaning&&h.append(` ${d.meaning}`)):n==="thai"?(l.textContent=a,m.textContent="?"):(l.textContent="?",m.textContent=a),o.appendChild(i))});const u=document.createElement("khao-card");u.setAttribute("filling","secondary"),u.classList.add("thai-food-dict-search__parts-card"),u.appendChild(o),t.appendChild(u)},Y=t=>{if(t.length===0)return null;const e=t.map(([,s])=>s?s.thainame:"?").join(""),n=t.map(([,s])=>s?s.trans:"?").join(" ");return{thainame:e,trans:n,meaning:""}},z=async(t,e,n)=>{const s=t.trim();if(s.length===0){p(n);return}try{const c=await N(s,e),r=c.entries.some(([,o])=>o!==null);if(c.entries.length===0||!r){p(n);return}W(n,c.entries,c.mode)}catch(c){console.error("Thai food dictionary search failed",c),p(n)}},_=()=>{var u;const t=document.getElementById(x),e=document.getElementById(B),n=document.getElementById(U),s=document.getElementById(O),c=document.getElementById(q);if(!t||!e||!s||!c)return;let r=I(t);t.addEventListener("khao-text-field-keyup",a=>{var i;r=((i=a.detail)==null?void 0:i.value)??""}),t.addEventListener("khao-text-field-keydown",a=>{var i;((i=a.detail)==null?void 0:i.key)==="Enter"&&g(t,s,c,r)}),e.addEventListener("click",()=>{g(t,s,c,r)});const o=(u=t.shadowRoot)==null?void 0:u.querySelector("input");o==null||o.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),g(t,s,c,r))}),n==null||n.addEventListener("click",()=>{"value"in t&&(t.value=""),t.setAttribute("value",""),F(t,"");const a={detail:{value:""},bubbles:!0,composed:!0};t.dispatchEvent(new CustomEvent("khao-text-field-change",a)),t.dispatchEvent(new CustomEvent("khao-text-field-keyup",a)),r="",p(c)})};document.readyState==="loading"?addEventListener("DOMContentLoaded",()=>{_()}):_();

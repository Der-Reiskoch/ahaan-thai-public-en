RewriteEngine on

# Allow multiple domains for multihost setup
RewriteCond %{HTTP_HOST} !^www\.ahaan-thai\.de$
RewriteCond %{HTTP_HOST} !^en\.ahaan-thai\.de$
RewriteCond %{REQUEST_URI} !^\/ads\.txt$
RewriteRule ^(.*)$ https://www.ahaan-thai.de/$1 [R=301,L]

# Normalize repeated slashes in request paths
RewriteCond %{THE_REQUEST} \s/+(.*)//+\s [NC]
RewriteRule ^ %1 [R=301,L]

# Redirect English content paths on German host to English domain
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^encyclopedia/(.*)$ https://en.ahaan-thai.de/encyclopedia/$1 [R=301,L]

RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^cookbooks/(.*)$ https://en.ahaan-thai.de/cookbooks/$1 [R=301,L]

# On German domain: redirect /index and /index/ to /lexikon/
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^index/?$ /lexikon/ [R=301,L]

# On German domain: redirect /index/* to /lexikon/*
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^index/(.+)$ /lexikon/$1 [R=301,L]


# On German domain: redirect common region typos
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^regions/zentalthailand/?$ /regions/zentralthailand/ [R=301,L]

# Redirect old /en/index URLs to English subdomains' encyclopedia
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^en/index/(.*)$ https://en.ahaan-thai.de/encyclopedia/$1 [R=301,L]

# Redirect old Quellen URLs to cookbook index
RewriteCond %{HTTP_HOST} ^www\.ahaan-thai\.de$
RewriteRule ^quellen/thailand/.*$ /kochbucher/thailand-das-kochbuch/ [R=301,L]

# On English domain: redirect /index and /index/ to /encyclopedia/
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^index/?$ /encyclopedia/ [R=301,L]

# On English domain: redirect /index/* to /encyclopedia/*
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^index/(.+)$ /encyclopedia/$1 [R=301,L]

# On English domain: redirect /lexikon/* to /encyclopedia/*
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^lexikon/(.+)$ /encyclopedia/$1 [R=301,L]

# On English domain: redirect /kochbucher/* to /cookbooks/*
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^kochbucher/(.*)$ /cookbooks/$1 [R=301,L]

# On English domain: redirect /suchen/* to /search/*
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^suchen/zufall/?$ /search/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^suchen/?$ /search/ [R=301,L]

# On English domain: fix region slug mismatches
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/nordthailand/?$ /regions/northern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/nordostthailand/?$ /regions/northeastern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/suedthailand/?$ /regions/southern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/zentralthailand/?$ /regions/central-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/north-thailand/?$ /regions/northern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/northeast-thailand/?$ /regions/northeastern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/south-thailand/?$ /regions/southern-thailand/ [R=301,L]

# On English domain: redirect region pagination from old slugs
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/northeast-thailand/page/[0-9]+/?$ /regions/northeastern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/north-thailand/page/[0-9]+/?$ /regions/northern-thailand/ [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^regions/south-thailand/page/[0-9]+/?$ /regions/southern-thailand/ [R=301,L]

# On English domain: fix common typo routes
RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^encyclopedia/y/yam-(.+)$ /encyclopedia/y/yum-$1 [R=301,L]

RewriteCond %{HTTP_HOST} ^en\.ahaan-thai\.de$
RewriteRule ^tags/stiry-fry/?$ /tags/stir-fry/ [R=301,L]

# Collapse duplicate letter segments
RewriteRule ^lexikon/([a-z])/\1/(.+)$ /lexikon/$1/$2 [R=301,L]
RewriteRule ^encyclopedia/([a-z])/\1/(.+)$ /encyclopedia/$1/$2 [R=301,L]

# Redirect tag pagination to base tag page
RewriteRule ^tags/(.+)/page/[0-9]+/?$ /tags/$1/ [R=301,L]

# Redirect old search handler
RewriteRule ^__cl__/?$ /worterbuch/erklaeren/ [R=301,L]

# Redirect old /en/* URLs to English subdomain
RewriteRule ^en/(.*)$ https://en.ahaan-thai.de/$1 [R=301,L]

#https://www.der-reiskoch.de/thaipause/tagebuch/2021/10/25/?fbclid=IwAR2podBLMAIkhlREuBv6cbjDJ8hXazuK60LH05pIvYezjZGVLWg_8AH4TI4
#remove facebook fbclid qeuery param
RewriteCond %{QUERY_STRING} ^(.*?)(&?fbclid=[a-zA-Z0-9_-]+)$
RewriteRule ^(.*)$ /$1?%1 [L,NE,R=301]

###############################################################################################

<IfModule mod_expires.c>
  ExpiresActive On

  ExpiresByType text/html "modification 4 hours"

  # Images
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"

  # Video
  ExpiresByType video/webm "access plus 1 year"
  ExpiresByType video/mp4 "access plus 1 year"
  ExpiresByType video/mpeg "access plus 1 year"

  # Fonts
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
  ExpiresByType application/font-woff "access plus 1 year"

  # CSS, JavaScript
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"

  # Others
  ExpiresByType application/pdf "access plus 1 year"
  ExpiresByType image/vnd.microsoft.icon "access plus 1 year"

  ExpiresDefault "access plus 1 year"
</IfModule>

# 404 pages handled by each domain separately in multihost setup
ErrorDocument 404 /404.html
